<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Farm Rush 3D | Playable Ad Demo</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #87CEEB;
            font-family: sans-serif;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            color: white;
            text-shadow: 2px 2px 0 #000;
        }

        h1 {
            margin: 0;
            font-size: 24px;
        }

        p {
            margin: 5px 0;
            font-size: 18px;
        }

        #cta {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: #4bff63;
            color: #004d00;
            padding: 15px 40px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 24px;
            cursor: pointer;
            display: none;
            box-shadow: 0 4px 0 #004d00;
            border: 2px solid white;
        }

        #cta:active {
            transform: translateX(-50%) translateY(4px);
            box-shadow: none;
        }
    </style>
</head>

<body>
    <div id="ui">
        <h1>FARM RUSH 3D</h1>
        <p>Eggs Collected: <span id="score">0</span>/3</p>
    </div>
    <div id="cta" onclick="window.location.reload()">PLAY AGAIN</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <script>
        // --- CONFIG ---
        const TARGET_EGGS = 3;
        let eggsCollected = 0;
        let isGameOver = false;

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        scene.fog = new THREE.Fog(0x87CEEB, 10, 50);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 20, 20);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Lights
        const ambient = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambient);
        const dir = new THREE.DirectionalLight(0xffffff, 0.8);
        dir.position.set(10, 20, 10);
        dir.castShadow = true;
        scene.add(dir);

        // Ground
        const groundGeo = new THREE.PlaneGeometry(50, 50);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x7cfc00 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // --- ASSETS (Procedural) ---
        // Player (Farmer)
        const playerGroup = new THREE.Group();
        const bodyGeo = new THREE.CylinderGeometry(0.5, 0.5, 1.5, 8);
        const bodyMat = new THREE.MeshStandardMaterial({ color: 0x0000ff });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        body.position.y = 0.75;
        body.castShadow = true;

        const headGeo = new THREE.SphereGeometry(0.4, 16, 16);
        const headMat = new THREE.MeshStandardMaterial({ color: 0xffccaa });
        const head = new THREE.Mesh(headGeo, headMat);
        head.position.y = 1.7;

        const hatGeo = new THREE.ConeGeometry(0.6, 0.5, 16);
        const hatMat = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
        const hat = new THREE.Mesh(hatGeo, hatMat);
        hat.position.y = 2.1;

        playerGroup.add(body, head, hat);
        scene.add(playerGroup);

        // Eggs
        const eggs = [];
        const eggGeo = new THREE.SphereGeometry(0.5, 16, 16);
        const eggMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
        eggGeo.scale(0.8, 1, 0.8);

        function spawnEgg(x, z) {
            const egg = new THREE.Mesh(eggGeo, eggMat);
            egg.position.set(x, 0.5, z);
            egg.castShadow = true;
            eggs.push(egg);
            scene.add(egg);

            // Floating anim
            new TWEEN.Tween(egg.position)
                .to({ y: 1 }, 1000)
                .yoyo(true)
                .repeat(Infinity)
                .easing(TWEEN.Easing.Quadratic.InOut)
                .start();
        }

        spawnEgg(5, 5);
        spawnEgg(-5, 5);
        spawnEgg(0, -5);

        // --- INTERACTION ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('pointerdown', (e) => {
            if (isGameOver) return;

            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(ground);

            if (intersects.length > 0) {
                const pt = intersects[0].point;
                moveTo(pt.x, pt.z);
            }
        });

        function moveTo(x, z) {
            // Simple tween move
            const dist = Math.sqrt(Math.pow(x - playerGroup.position.x, 2) + Math.pow(z - playerGroup.position.z, 2));
            const duration = dist * 200; // Speed

            playerGroup.lookAt(x, playerGroup.position.y, z);

            new TWEEN.Tween(playerGroup.position)
                .to({ x: x, z: z }, duration)
                .start();
        }

        // --- LOOP ---
        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);

            // Logic
            if (!isGameOver) {
                for (let i = eggs.length - 1; i >= 0; i--) {
                    const egg = eggs[i];
                    const dist = playerGroup.position.distanceTo(egg.position);
                    if (dist < 1.0) {
                        // Collect
                        scene.remove(egg);
                        eggs.splice(i, 1);
                        eggsCollected++;
                        document.getElementById('score').innerText = eggsCollected;

                        // FX
                        playerGroup.scale.set(1.2, 1.2, 1.2);
                        new TWEEN.Tween(playerGroup.scale).to({ x: 1, y: 1, z: 1 }, 300).start();

                        if (eggsCollected >= TARGET_EGGS) {
                            win();
                        }
                    }
                }
            }

            renderer.render(scene, camera);
        }

        function win() {
            isGameOver = true;
            document.getElementById('cta').style.display = 'block';
            document.getElementById('ui').innerHTML = "<h1>LEVEL COMPLETE!</h1>";

            // Victory Dance
            new TWEEN.Tween(playerGroup.rotation)
                .to({ y: Math.PI * 4 }, 2000)
                .start();
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>

</html>